<!DOCTYPE html>
<html>
  <head>
    <title>
      wesleyhales.com: Using Facelets TagHandlers and Adding multiple listeners
    </title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <link href='/stylesheets/global.css' media='screen, print' rel='stylesheet' type='text/css' />
    <link href='/blog.atom' rel='alternate' type='application/atom+xml' />
    <script src='/js/modernizr.js' type='text/javascript'></script>
  </head>
  <body>
    <header>
      <div class='header-box' onclick="window.location = 'http://wesleyhales.com'">
        <div class='logo-bold'>wesleyhales<span>.com</span></div>
        <nav class='console'>
          <ul id='menu'>
            <li id='home'>
              <a href='/index.html'>Blog</a>
            </li>
            <li id='design'>
              <a href='/design/?p=design'>Design</a>
            </li>
            <li id='projects'>
              <a href='/projects/?p=projects'>Projects</a>
            </li>
            <li id='contact'>
              <a href='/contact/?p=contact'>Contact</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <aside id='rightcol'>
      <div class='shadow-helper'>
        <div class='left-toolbar'>
          <section class='tweets'>
            <header>
              <h2 class='tweets-title'>
                <a href='http://twitter.com/wesleyhales'>
                  <img src='//si0.twimg.com/images/dev/cms/intents/bird/bird_blue/bird_16_blue.png' />
                  Tweets
                </a>
              </h2>
              <div id='twitter_div'>
                <ul id='twitter_update_list'></ul>
              </div>
            </header>
          </section>
          <section class='tags'>
            <header>
              <h2 class='tags-title'>
                Tags
              </h2>
            </header>
            <span class='tag tag-0'>
              <a href='/blog/tags/2.0/'>2.0</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/2011/'>2011</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/301/'>301</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/Design/'>Design</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/JSF/'>JSF</a>
            </span>
            <span class='tag tag-6'>
              <a href='/blog/tags/Java/'>Java</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/Life/'>Life</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/Utils/'>Utils</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/aerogear/'>aerogear</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/ajax/'>ajax</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/ajaxworld/'>ajaxworld</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/anniversary/'>anniversary</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/ant/'>ant</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/anthem/'>anthem</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/bad/'>bad</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/balls/'>balls</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/blog/'>blog</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/bridge/'>bridge</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/cargo/'>cargo</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/cdi/'>cdi</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/conferences/'>conferences</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/container/'>container</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/css/'>css</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/css3/'>css3</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/demo/'>demo</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/design/'>design</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/drive/'>drive</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/enterprise/'>enterprise</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/facebook/'>facebook</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/file/'>file</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/firefox/'>firefox</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/flying/'>flying</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/forensics/'>forensics</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/framework/'>framework</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/god/'>god</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/growl/'>growl</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/hard/'>hard</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/hibernate/'>hibernate</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/hornetq/'>hornetq</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/html5/'>html5</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/html5e/'>html5e</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/infinispan/'>infinispan</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/innerhtml/'>innerhtml</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/iscroll/'>iscroll</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jazoon/'>jazoon</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/jboss/'>jboss</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jesus/'>jesus</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jetty/'>jetty</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jms/'>jms</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jquery/'>jquery</a>
            </span>
            <span class='tag tag-2'>
              <a href='/blog/tags/jsf/'>jsf</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/jsr/'>jsr</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/kick/'>kick</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/life/'>life</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/lrd/'>lrd</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/maven/'>maven</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/mobile/'>mobile</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/modal/'>modal</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/opensocial/'>opensocial</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/pdf/'>pdf</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/phonegap/'>phonegap</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/portal/'>portal</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/portals/'>portals</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/portlet/'>portlet</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/portlets/'>portlets</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/recovery/'>recovery</a>
            </span>
            <span class='tag tag-2'>
              <a href='/blog/tags/richfaces/'>richfaces</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/saucer/'>saucer</a>
            </span>
            <span class='tag tag-2'>
              <a href='/blog/tags/seam/'>seam</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/theme/'>theme</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/tomcat/'>tomcat</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/trinidad/'>trinidad</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/undelete/'>undelete</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/util/'>util</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/vacation/'>vacation</a>
            </span>
            <span class='tag tag-1'>
              <a href='/blog/tags/web/'>web</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/websocket/'>websocket</a>
            </span>
            <span class='tag tag-0'>
              <a href='/blog/tags/weld/'>weld</a>
            </span>
          </section>
          <div class='none' id='fillitkillit'>
            Why waste this space?
            <br />
            <a href='javascript:fillit();void(0)'>fill</a>
            |
            <a href='javascript:killit();void(0)'>kill</a>
          </div>
        </div>
      </div>
    </aside>
    <div id='main'>
      <div id='post-container'>
        <div class='article-list'>
          <div class='post_navigation'>
            <div class='previous_post link'>
              Previous:
              <a href='/blog/2006/12/18/My-Jroller-Blog-Extreme-Makeover/'>
                My Jroller Blog Extreme Makeover
              </a>
            </div>
            <div class='next_post link'>
              Next:
              <a href='/blog/2006/12/26/Ajax4Jsf-Modal-Loading-Windows/'>
                Ajax4Jsf Modal Loading Windows
              </a>
            </div>
            <div class='clearfix'></div>
          </div>
          <div class='post'>
            <h2 class='title'>
              Using Facelets TagHandlers and Adding multiple listeners
            </h2>
            <h3 class='date'>
              18 December 2006
            </h3>
            <h4 class='tags'>
              <a href='/blog/tags/Java/'>
                Java
              </a>
            </h4>
            <div class='content'>
              
              
              <p>
              ComponentHandler, HtmlComponentHandler, or TagHandler. So I think I finally have a handle on what each of these are used for. Okay the first 2 are easy, HtmlComponentHandler extends ComponentHandler. But what is a MetaRuleset and what can it do for my components? It looks to mee like it is just a method binding passthrough for the component when you call <code>MetaRuleset.addRule(typeTagRule);</code>?
              </p>
              
              
              <p>
              TagHandler ended up saving the day for me, and after spending hours/days trying to get the first 2 to do what I was wanting, this one took me like 5 minutes. I was trying to add a handler to a component which turned out to be the wrong thing to do in facelets. Now, All one has to do is declare a tag in the *taglib.xml file and point it to the new handler class (as explained on Facelets docs). 
              </p>
              
              
              <p><code></p>&#x000A;&#x000A;<pre>&#x000A;</span><a name="l41">    <span class="s2">&lt;</span><span class="s5">tag</span><span class="s2">&gt;</span><span class="s0"> &#x000A;</span></a><a name="l42">        <span class="s2">&lt;</span><span class="s5">tag-name</span><span class="s2">&gt;</span><span class="s6">sliderListener</span><span class="s2">&lt;/</span><span class="s5">tag-name</span><span class="s2">&gt;</span><span class="s0"> &#x000A;</span></a><a name="l43">        <span class="s2">&lt;</span><span class="s5">handler-class</span><span class="s2">&gt;</span><span class="s6">com.halesconsulting.web.jsf.handler.SliderTagHandler</span><span class="s2">&lt;/</span><span class="s5">handler-class</span><span class="s2">&gt;</span><span class="s0"> &#x000A;</span></a><a name="l44">    <span class="s2">&lt;/</span><span class="s5">tag</span><span class="s2">&gt;</span><span class="s0"> </a>&#x000A;</pre>&#x000A;&#x000A;&#x000A;<p></code></p>
              
              <p>
              Next is defining the required and not-required attributes for your tag in the class.
              </p>
              
              
              <p><code></p>&#x000A;&#x000A;<pre>&#x000A;</span></a><a name="l27">  <span class="s0">private final </span><span class="s1">TagAttribute test; &#x000A;</span></a><a name="l28">  <span class="s0">private final </span><span class="s1">TagAttribute var; </a></a>&#x000A;</pre>&#x000A;&#x000A;&#x000A;<p></code>
              <code></p>&#x000A;&#x000A;<pre>&#x000A;</span></a><a name="l35">  <span class="s0">public </span><span class="s1">SliderTagHandler(TagConfig config) { &#x000A;</span></a><a name="l36">      <span class="s0">super</span><span class="s1">(config); &#x000A;</span></a><a name="l37"> &#x000A;</a><a name="l38">      <span class="s2">// helper method for getting a required attribute</span><span class="s1"> &#x000A;</span></a><a name="l39">      <span class="s0">this</span><span class="s1">.test = </span><span class="s0">this</span><span class="s1">.getRequiredAttribute(</span><span class="s4">"type"</span><span class="s1">); &#x000A;&#x000A;</span></a><a name="l40"> &#x000A;</a><a name="l41">      <span class="s2">// helper method</span><span class="s1"> &#x000A;</span></a><a name="l42">      <span class="s0">this</span><span class="s1">.var = </span><span class="s0">this</span><span class="s1">.getAttribute(</span><span class="s4">"var"</span><span class="s1">); &#x000A;</span></a><a name="l43">  } </a></a></a></a></a>&#x000A;</pre>&#x000A;&#x000A;&#x000A;<p></code></p>
              
              <p>Next, in the apply method, I was able to get this tags parent component instance (just like in JSP component development where you call <code>UIComponentTag tag = UIComponentTag.getParentUIComponentTag(pageContext);</code> It took me a while to figure out where I needed to do this, but after this worked, you should have seen the excitement! Nothing like figuring shit out on your own when no documentation could be found on what you are trying to do!</p>
              
              
              <p></p>
              
              <p>I had to add a HashMap to keep track of what listeners had already been added. Otherwise, each render added a new listener...</p>
              
              
              <p><code></p>&#x000A;&#x000A;<pre>&#x000A;</a><a name="l45">  <span class="s2">/** &#x000A;&#x000A;</span></a><a name="l46">   * Threadsafe Method for controlling evaluation of &#x000A;</a><a name="l47">   * its child tags, represented by "nextHandler" &#x000A;</a><a name="l48">   */<span class="s1"> &#x000A;</span></a><a name="l49">  <span class="s0">public void </span><span class="s1">apply(FaceletContext ctx, UIComponent parent) </span><span class="s0">throws </span><span class="s1">IOException, FacesException, ELException { &#x000A;</span></a><a name="l50"> &#x000A;</a><a name="l51">      <span class="s0">boolean </span><span class="s1">b = </span><span class="s0">this</span><span class="s1">.test.getBoolean(ctx); &#x000A;&#x000A;</span></a><a name="l52"> &#x000A;</a><a name="l53">      <span class="s0">if </span><span class="s1">(!addedMap.containsKey(test.getValue())){ &#x000A;</span></a><a name="l54">          SliderSource sliderSource = (SliderSource)parent; &#x000A;</a><a name="l55">          SliderListener listener = createSliderListener(test.getValue()); &#x000A;</a><a name="l56">          addedMap.put(test.getValue(),<span class="s0">true</span><span class="s1">); &#x000A;</span></a><a name="l57">          sliderSource.addSliderListener(listener); &#x000A;</a><a name="l58">      } &#x000A;</a><a name="l59">       &#x000A;&#x000A;</a><a name="l60">      <span class="s0">if </span><span class="s1">(</span><span class="s0">this</span><span class="s1">.var != </span><span class="s0">null</span><span class="s1">) { &#x000A;</span></a><a name="l61">          ctx.setAttribute(var.getValue(ctx), <span class="s0">new </span><span class="s1">Boolean(b)); &#x000A;</span></a><a name="l62">      } &#x000A;</a><a name="l63">      <span class="s0">if </span><span class="s1">(b) { &#x000A;</span></a><a name="l64">          <span class="s0">this</span><span class="s1">.nextHandler.apply(ctx, parent); &#x000A;&#x000A;</span></a><a name="l65">      } &#x000A;</a><a name="l66">  } </a>&#x000A;</pre>&#x000A;&#x000A;&#x000A;<p></code></p>
              
              <p>I still need to do a little more digging on the details of the nextHandler stuff. But I was happy to get it working the "right way"</p>
              
              
              <p></p>
            </div>
            <div class='comments'>
              
                          <div id="disqus_thread"></div>
                          <script type="text/javascript">
                          var disqus_shortname = 'wesleyhales';
                          var disqus_url = "http://www.wesleyhales.com/blog/2006/12/18/Using-Facelets-TagHandlers-and-Adding-multiple-listeners/";
                          var disqus_developer = null;
                          var disqus_identifier = null;
                          (function() {
                            var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                            dsq.src = "http://wesleyhales.disqus.com/embed.js";
                            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                          })();
                          </script>
                          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=wesleyhales">comments powered by Disqus.</a></noscript>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br class='clear' />
    <script src='//platform.twitter.com/widgets.js' type='text/javascript'></script>
    <script src='http://twitter.com/javascripts/blogger.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        function twitterCallback3(twitters) {
          var statusHTML = [];
          for (var i=0; i<twitters.length; i++){
            var username = twitters[i].user.screen_name;
            var status = twitters[i].text.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g, function(url) {
              return '<a href="'+url+'">'+url+'</a>';
            }).replace(/\B@([_a-z0-9]+)/ig, function(reply) {
              return  reply.charAt(0)+'<a href="http://twitter.com/'+reply.substring(1)+'">'+reply.substring(1)+'</a>';
            });
            statusHTML.push('<li><div>'+status+'</div><div class="actions"><a href="http://twitter.com/'+username+'/statuses/'+twitters[i].id_str+'">'+relative_time(twitters[i].created_at)+'</a>|<a class="tweet_action tweet_retweet" href="http://twitter.com/intent/retweet?tweet_id='+twitters[i].id_str+'"><img src="//si0.twimg.com/images/dev/cms/intents/icons/retweet.png">retweet</a>|<a class="tweet_action tweet_reply" href="http://twitter.com/intent/tweet?in_reply_to='+twitters[i].id_str+'"><img src="//si0.twimg.com/images/dev/cms/intents/icons/reply.png">reply</a></div></li>');
          }
          document.getElementById('twitter_update_list').innerHTML = statusHTML.join('');
        }
        
        // my custom JS
        
        //get a request pramaeter
        function getParameterByName(name) {
          var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
          return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }   
        
        //reckless abandon - adding querySelector as an option to getElementById
        var orig = document.getElementById;
        document.getElementById = function(){
          if (document.querySelector){
              return document.querySelector('#' + arguments[0]);
          }else{
              return orig(arguments[0]);
          }
        }   
        
        //navigation based on above method... could be better
        if(getParameterByName("p") == "design"){
          document.getElementById('design').className = 'selected';
        } else if(getParameterByName("p") == "projects"){
          document.getElementById('projects').className = 'selected';
        } else if(getParameterByName("p") == "contact"){
          document.getElementById('contact').className = 'selected';
        } else {
          document.getElementById('home').className = 'selected';
        }
        //-----------------------------------------/end nav
        
        var killed = false;
        
        if((!Modernizr.touch || window.innerWidth > 980)) {
          try{
            //todo need to handle orientation change here as well
            window.onscroll = function(){
              if(!killed){
                if(typeof( window.pageYOffset ) == 'number'){
                  if(window.pageYOffset > 1650) {
                    showNotif();
                  }else{
                    document.getElementById("fillitkillit").className = 'sticky-top-right notif transition hide';
                  }
                }else{
                  //lets deal with IE for the hell of it
                  if(document.documentElement.scrollTop > 1650 ){
                    showNotif();
                  }else{
                    document.getElementById("fillitkillit").className = 'none';
                  }
                }
              }
            }
          }catch(e){
            //swallow
          }
        }
        
        function showNotif(){
          document.getElementById("fillitkillit").className = 'sticky-top-right notif transition show';
        }
        //
        function fillit() {
          document.getElementById('rightcol').className = 'hidden';
          document.getElementById('post-container').style.width = '100%';
          document.getElementById('post-container').style.padding = '15px 0 15px 15px';
          document.getElementById('post-container').className = 'transition';
          document.getElementById('main').style.margin = '154px 0 0 0';
          document.getElementById('main').className = 'transition';
          killit();
        }
        
        function killit() {
          if(document.documentElement){
             //again, deal with IE
             document.getElementById("fillitkillit").className = 'none'
          }else{
             document.getElementById("fillitkillit").className = 'sticky-top-right notif transition hide'  
          }
          
          killed = true;
        }
      //]]>
    </script>
    <script src='http://twitter.com/statuses/user_timeline/wesleyhales.json?callback=twitterCallback3&amp;amp;count=2' type='text/javascript'></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-1241000-10");
    pageTracker._trackPageview();
    } catch(err) {}</script>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <title>
      wesleyhales.com: Jank Busting Apple's Home Page
    </title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="/stylesheets/global.css?v31" media="screen, print" rel="stylesheet" type="text/css">
    <link href="/blog.atom" rel="alternate" type="application/atom+xml">
    <script defer="defer" src="/js/modernizr.js" type="text/javascript"></script>
    <script src="//www.google-analytics.com/cx/api.js?experiment=0000001" type="text/javascript"></script>
    <script>
      var image_variations = [
        'original.png',
        'variation1.png',
        'variation2.png'
      ]
      
      // 2. Choose the Variation for the Visitor
      var variation = cxApi.chooseVariation();
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-1241000-10', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header>
      <div class="header-box" onclick="window.location = 'http://wesleyhales.com'">
        <div class="logo-bold">wesleyhales<span>.com</span></div>
        <nav class="console">
          <ul id="menu">
            <li id="home">
              <a href="/index.html">Blog</a>
            </li>
            <li id="design">
              <a href="/design/?p=design">Projects</a>
            </li>
            <li id="projects">
              <a href="/contact/?p=contact">Me</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <aside id="rightcol">
      <div class="shadow-helper">
        <div class="left-toolbar">
          <section class="tags">
            <header>
              <h2 class="tags-title">
                Upcoming Events
              </h2>
              <div class="upcoming-container">
                <a href="http://fluentconf.com/fluent2014/public/schedule/detail/32856" target="blank">
                  <img class="float-left" src="/images/icons/fluent2013_logo_reg.gif" width="150px">
                </a>
                <a href="http://devnexus.com/s/speakers" target="blank">
                  <img class="float-right" src="/images/icons/devnexus.png">
                </a>
              </div>
            </header>
          </section>
          <section class="clear recent-comments">
            <header>
              <div class="dsq-widget" id="recentcomments">
                <h2 class="dsq-widget-title">
                  Recent Comments
                </h2>
                <script src="http://wesleyhales.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=24&amp;excerpt_length=200" type="text/javascript"></script>
              </div>
            </header>
          </section>
          <section class="tags">
            <header>
              <h2 class="tags-title">
                My Book
              </h2>
              <div class="book-container">
                <a href="http://www.amazon.com/HTML5-JavaScript-Apps-Wesley-Hales/dp/1449320511/">
                  <img src="/images/icons/mybook.png">
                </a>
              </div>
            </header>
          </section>
          <section class="tweets" style="margin: 20px 0 0 0;">
            <header>
              <a class="twitter-timeline" data-dnt="true" data-widget-id="276405487782739969" href="https://twitter.com/wesleyhales">Tweets by @wesleyhales</a>
              <script>
                !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
              </script>
            </header>
          </section>
        </div>
      </div>
    </aside>
    <div id="main">
      <div id="post-container">
        <div class="article-list">
          <div class="post_navigation">
            <div class="previous_post link">
              Previous:
              <a href="/blog/2013/10/23/Basic-Screen-Updates-with-Angular-and-requestAnimationFrame/">
                Basic Screen Updates with Angular and requestAnimationFrame
              </a>
            </div>
            <div class="next_post link">
              Next:
              <a href="/blog/2013/12/17/Designing-and-Implementing-an-Angular-Dashboard/">
                From Startup to Enterprise
              </a>
            </div>
            <div class="clearfix"></div>
          </div>
          <div class="post">
            <h2 class="title">
              Jank Busting Apple's Home Page
            </h2>
            <h3 class="date">
              26 October 2013
            </h3>
            <h4 class="tags">
              <a href="/blog/tags/jank/">
                jank
              </a>
              |
            </h4>
            <div class="content">
              <br/>
              
              
              <h2>Overview</h2>
              
              <p>Watching frame rates on CSS and/or JavaScript animation is pretty addictive. I wrote <a href="/blog/2013/10/23/Basic-Screen-Updates-with-Angular-and-requestAnimationFrame/">this article</a> the other day which examines the
              performance of a simple countdown timer within the Angular lifecycle. I then spent countless minutes playing
              Jake Archibald's <a href="http://jakearchibald.github.io/jank-invaders/">Jank Invaders</a> to hone my skills and save the universe from jank :)</p>
              
              <p>So, I was on <a href="http://apple.com">Apple's home page</a> the other day and noticed some jank in their main carousel animation.
              <a href="/images/posts/2013-10-26/apple.home.PNG"><img src="/images/posts/2013-10-26/apple.home.PNG" alt="apple home page" style="width:50%" class="margin10"></a>
              It wasn't anything huge, but the
              animation seemed to stagger a bit as the transitions were beginning and ending. There are five transitions that occur to display different
              Apple products. You can see this in the Frame analysis below. Each green line shooting to 0 FPS is a <a href="https://developers.google.com/chrome-developer-tools/docs/timeline#painting_events">paint</a> within chrome.
              <a href="/images/posts/2013-10-26/apple.com.jank.PNG"><img src="/images/posts/2013-10-26/apple.com.jank.PNG" alt="bad fps jank" class="marginTop10 max-width-100"></a></p>
              
              <p>Digging deeper, we can see that a large amount of time is being taken for the hardware compositing. This is where we force elements to be accelerated and
               handled by the GPU with translate3D(0,0,0) or translateZ(0) (aka <a href="http://aerotwist.com/blog/on-translate3d-and-layer-creation-hacks/">null transform hack</a>).
               The problem with Apple's site and the reason why paints are spiking before each animation is because too many layers (or divs) have the null transform applied.
               <img src="/images/posts/2013-10-26/composite.PNG" alt="layer composite time" class="margin10 max-width-100"/>
               <br/>
               I wrote about this <a href="http://www.html5rocks.com/en/mobile/optimization-and-performance/">a while ago</a>, but the basic point is that too much of a good thing is often a bad thing. In this case, too many elements have translateZ(0)
               applied when only one or two applications are really needed. This is forcing a longer composite time and ultimately giving the animations some jank.</p>
              
              <p> The fix is easy. Start with the top level container for the animation and see which of the child elements have a null transform and figure out if they really need it.
               If we turn on "<a href="http://updates.html5rocks.com/2013/02/Profiling-Long-Paint-Times-with-DevTools-Continuous-Painting-Mode">Continuous Page Repainting</a>" in dev tools, we can see how the page is being painted and how many composited layers we have.
               <a href="/images/posts/2013-10-26/apple-paint.PNG"><img src="/images/posts/2013-10-26/apple-paint.PNG" alt="bad fps jank" class="marginTop10 max-width-100"></a></p>
              
              <p> By viewing the source and running through each element of the carousel animation, we can see that the parent already has the proper layer compositing.
               From there, I just disabled all the null transform hacks that were applied to nested elements.
               <a href="/images/posts/2013-10-26/apple.markup.PNG"><img src="/images/posts/2013-10-26/apple.markup.PNG" alt="apple home page markup" class="marginTop10 max-width-100"></a></p>
              
              <p> After doing this and fixing one other tiny CSS bug of one element having two different backgrounds, we get much better performance as you can see in the
               below timeline.
               <a href="/images/posts/2013-10-26/apple.com.no.jank.PNG"><img src="/images/posts/2013-10-26/apple.com.no.jank.PNG" alt="apple home page markup" class="marginTop10 max-width-100"></a></p>
              
              <p> The yellow bars are the 7 second timer before each transition occurs, so this is expected.</p>
              
              <p> The animation on Apple.com isn't terrible as it stands in its current state, but as I stated at the beginning of this article, it's fun to fix jank :)</p>
              
              <p> <br/>
               <br/></p>
              
              <br/>
              
              
              <br/>
            </div>
            <div class="comments">
              
                          <div id="disqus_thread"></div>
                          <script type="text/javascript">
                          var disqus_shortname = 'wesleyhales';
                          var disqus_url = "http://www.wesleyhales.com/blog/2013/10/26/Jank-Busting-Apples-Home-Page/";
                          var disqus_developer = null;
                          var disqus_identifier = null;
                          (function() {
                            var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                            dsq.src = "http://wesleyhales.disqus.com/embed.js";
                            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                          })();
                          </script>
                          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=wesleyhales">comments powered by Disqus.</a></noscript>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br class="clear">
    <script defer="defer" src="/js/site.js" type="text/javascript"></script>
  </body>
</html>

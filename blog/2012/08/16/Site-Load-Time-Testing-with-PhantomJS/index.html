<!DOCTYPE html>
<html>
  <head>
    <title>
      wesleyhales.com: Web Performance Testing With PhantomJS
    </title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type' />
    <link href='/stylesheets/global.css?v25' media='screen, print' rel='stylesheet' type='text/css' />
    <link href='/blog.atom' rel='alternate' type='application/atom+xml' />
    <script src='/js/modernizr.js' type='text/javascript'></script>
  </head>
  <body>
    <header>
      <div class='header-box' onclick="window.location = 'http://wesleyhales.com'">
        <div class='logo-bold'>wesleyhales<span>.com</span></div>
        <nav class='console'>
          <ul id='menu'>
            <li id='home'>
              <a href='/index.html'>Blog</a>
            </li>
            <li id='design'>
              <a href='/design/?p=design'>Projects</a>
            </li>
            <li id='projects'>
              <a href='/contact/?p=contact'>Me</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <aside id='rightcol'>
      <div class='shadow-helper'>
        <div class='left-toolbar'>
          <section class='recent-comments'>
            <header>
              <div class='dsq-widget' id='recentcomments'>
                <h2 class='dsq-widget-title'>
                  Recent Comments
                </h2>
                <script src='http://wesleyhales.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=24&amp;excerpt_length=200' type='text/javascript'></script>
              </div>
            </header>
          </section>
          <section class='tags'>
            <header>
              <h2 class='tags-title'>
                My Book
              </h2>
              <div class='book-container'>
                <a href='http://shop.oreilly.com/product/0636920024088.do'>
                  <img src='/images/icons/mybook.png' />
                </a>
              </div>
            </header>
          </section>
          <section class='tweets'>
            <header>
              <h2 class='tweets-title'>
                <a href='http://twitter.com/wesleyhales'>
                  <img src='//si0.twimg.com/images/dev/cms/intents/bird/bird_blue/bird_16_blue.png' />
                  Tweets
                </a>
              </h2>
              <div id='twitter_div'>
                <ul id='twitter_update_list'></ul>
              </div>
            </header>
          </section>
        </div>
      </div>
    </aside>
    <div id='main'>
      <div id='post-container'>
        <div class='article-list'>
          <div class='post_navigation'>
  <div class='previous_post link'>
    Previous:
    <a href='/blog/2012/07/19/HTML5-in-Atlanta/'>
      HTML5 is Booming in Atlanta
    </a>
  </div>
  <div class='clearfix'></div>
</div>
<div class='post'>
  <h2 class='title'>
    Web Performance Testing With PhantomJS
  </h2>
  <h3 class='date'>
    16 August 2012
  </h3>
  <h4 class='tags'>
    <a href='/blog/tags/phantomjs/'>
      phantomjs
    </a>
    |
    <a href='/blog/tags/web performance/'>
      web performance
    </a>
    |
    <a href='/blog/tags/testing/'>
      testing
    </a>
    |
  </h4>
  <div class='content'>
    <p><img src="/images/icons/phantomjs.png" alt="phantomjs" align="left" class="max-width-100 margin10"></p>

<p>HTTP requests, heavy/unminified resources, and UI thread blocking should be on the mind of every front-end developer. These
are just a few issues that can cause serious bottlenecks in page load times. Having a faster load time equals better search engine
rankings, higher conversion rates, and an overall reduction in bandwidth costs.</p>

<p>I recently took on the task of coming up with an accurate way to measure all the aforementioned things, in an effort to understand
which performance tweaks improved page load times and which ones didn't. But first, we needed a baseline to test how fast the page loads with both a clear-cache and primed-cache state; Enter PhantomJS.
PhantomJS gives us a way to headlessly test page performance, and also gives us the automation we need for integration with any build system.
For this article, I will explain the reporting tool I used and try to give you a starting point for testing your own site(s).</p>

<p>First off, I started with James Pierce's <a href="https://github.com/jamesgpearce/confess/">confess.js</a> which gives us the elapsed load
time of a web page, the slowest and fastest resources, along with many other cool things like automatic generation of an appcache manifest. However, it did not give us
the document.readyState=interactive/complete or window.onload times. Another thing I wanted to measure was before and after cache. So If at first,
we have resources which are not far-future cached, what happens after we future cache these things? Also, how fast does our page load after
 being cached?</p>

<p>With a few performance focused modifications to confess.js, we are able to gather the following results:</p>

<ul>
<li>document.readyState</li>
<li>image filmstrip (how the page looks over load time)</li>
<li>page and resource load times after the user has a primed cache.</li>
<li>pretty effin cool charts with sparklines fed by knockout.js</li>
</ul>


<p>This script is running live at <a href="http://loadreport.wesleyhales.com/report.html">loadreport.wesleyhales.com/report.html</a>
<img src="/images/loadreport.js.png" alt="loadreport.js" align="left" class="max-width-100"></p>

<p>We're running the test 5 times in a row, to give an average of your best load times and to see where spikes occur. Also, <a href="http://twitter.com/ryanbridges">@ryanbridges</a> put together
some awesome sparkline charts backed by knockout.js. Just click on the "Show Me Some Charts!" button to see 'em.
<img src="/images/loadreport-charts.png" alt="loadreport-charts" align="left" class="max-width-100 margin10"></p>

<p>Regarding cache performance, phantomjs has a --disk-cahe=yes switch which is supposed to enable caching, but the results on the number
of resources loaded and their size seem to be reversed. For example, if we run this script against cnn.com with --disk-cahe=yes, phantom returns
over 2MB of resources, but if we run it with the same switch set to "no", we get 858KB of resources - and both modes report the same number
of resources being loaded (around 150).
To bypass this bug, I've created my own caching mechanism which basically loads the same page twice (in the same phantom instance)
 and returns more accurate results when compared with Chrome's developer tools.</p>

<p>Install <a href="http://phantomjs.org/">phantomjs</a> 1.6+, <a href="https://github.com/wesleyhales/loadreport">Get the script here</a> and run this on your own build servers to make sure your UI screams.</p>

<p><a href="http://twitter.com/wesleyhales">@wesleyhales</a></p>

<br/>


<br/>
  </div>
  <div class='comments'>
    
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                var disqus_shortname = 'wesleyhales';
                var disqus_url = "http://www.wesleyhales.com/blog/2012/08/16/Site-Load-Time-Testing-with-PhantomJS/";
                var disqus_developer = null;
                var disqus_identifier = null;
                (function() {
                  var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                  dsq.src = "http://wesleyhales.disqus.com/embed.js";
                  (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=wesleyhales">comments powered by Disqus.</a></noscript>
  </div>
</div>
        </div>
      </div>
    </div>
    <br class='clear' />
    <script src='//platform.twitter.com/widgets.js' type='text/javascript'></script>
    <script src='http://twitter.com/javascripts/blogger.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        function twitterCallback3(twitters) {
          var statusHTML = [];
          //var ls = 'localStorage' in window && window['localStorage'] !== null;
          for (var i=0; i<twitters.length; i++){
            var username = twitters[i].user.screen_name;
            var status = twitters[i].text.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g, function(url) {
              return '<a href="'+url+'">'+url+'</a>';
            }).replace(/\B@([_a-z0-9]+)/ig, function(reply) {
              return  reply.charAt(0)+'<a href="http://twitter.com/'+reply.substring(1)+'">'+reply.substring(1)+'</a>';
            });
            statusHTML.push('<li><div>'+status+'</div><div class="actions"><a href="http://twitter.com/'+username+'/statuses/'+twitters[i].id_str+'">'+relative_time(twitters[i].created_at)+'</a>|<a class="tweet_action tweet_retweet" href="http://twitter.com/intent/retweet?tweet_id='+twitters[i].id_str+'"><img src="//si0.twimg.com/images/dev/cms/intents/icons/retweet.png">retweet</a>|<a class="tweet_action tweet_reply" href="http://twitter.com/intent/tweet?in_reply_to='+twitters[i].id_str+'"><img src="//si0.twimg.com/images/dev/cms/intents/icons/reply.png">reply</a></div></li>');
          }
          document.getElementById('twitter_update_list').innerHTML = statusHTML.join('');
        }
        
        // my custom JS
        
        //get a request pramaeter
        function getParameterByName(name) {
          var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
          return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
        }   
        
        //reckless abandon - adding querySelector as an option to getElementById
        var orig = document.getElementById;
        document.getElementById = function(){
          if (document.querySelector){
              return document.querySelector('#' + arguments[0]);
          }else{
              return orig(arguments[0]);
          }
        }   
        
        //navigation based on above method... could be better
        if(getParameterByName("p") == "design"){
          document.getElementById('design').className = 'selected';
        } else if(getParameterByName("p") == "projects"){
          document.getElementById('projects').className = 'selected';
        } else if(getParameterByName("p") == "contact"){
          document.getElementById('contact').className = 'selected';
        } else {
          document.getElementById('home').className = 'selected';
        }
        
        //-----------------------------------------/end nav
        
        /*var killed = false;
        
        if((!Modernizr.touch || window.innerWidth > 980)) {
          try{
            //todo need to handle orientation change here as well
            window.onscroll = function(){
              if(!killed){
                if(typeof( window.pageYOffset ) == 'number'){
                  if(window.pageYOffset > 1650) {
                    showNotif();
                  }else{
                    document.getElementById("fillitkillit").className = 'sticky-top-right notif transition hide';
                  }
                }else{
                  //lets deal with IE for the hell of it
                  if(document.documentElement.scrollTop > 1650 ){
                    showNotif();
                  }else{
                    document.getElementById("fillitkillit").className = 'none';
                  }
                }
              }
            }
          }catch(e){
            //swallow
          }
        }
        
        function showNotif(){
          document.getElementById("fillitkillit").className = 'sticky-top-right notif transition show';
        }
        //
        function fillit() {
          document.getElementById('rightcol').className = 'hidden';
          document.getElementById('post-container').style.width = '100%';
          document.getElementById('post-container').style.padding = '15px 0 15px 15px';
          document.getElementById('post-container').className = 'transition';
          document.getElementById('main').style.margin = '154px 0 0 0';
          document.getElementById('main').className = 'transition';
          killit();
        }
        
        function killit() {
          if(document.documentElement){
             //again, deal with IE
             document.getElementById("fillitkillit").className = 'none'
          }else{
             document.getElementById("fillitkillit").className = 'sticky-top-right notif transition hide'  
          }
          
          killed = true;
        }*/
      //]]>
    </script>
    <script src='http://twitter.com/statuses/user_timeline/wesleyhales.json?callback=twitterCallback3&amp;amp;count=2' type='text/javascript'></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-1241000-10");
    pageTracker._trackPageview();
    } catch(err) {}</script>
  </body>
</html>
